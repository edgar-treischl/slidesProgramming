<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>R Programming</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/xaringanExtra-progressBar/progress-bar.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <meta name="description" content="Slides: R Programming"/>
    <meta name="generator" content="Programming with R and purrr"/>
    <meta name="github-repo" content="edgar-treischl/slidesProgramming"/>
    <meta name="twitter:title" content="R Programming"/>
    <meta name="twitter:description" content="Slides: R Programming"/>
    <meta name="twitter:url" content="https://edgar-treischl.github.io/slidesProgramming"/>
    <meta name="twitter:image" content="https://edgar-treischl.github.io/slidesProgramming&#10;/images/preview.png"/>
    <meta name="twitter:image:alt" content="Title Slide"/>
    <meta name="twitter:card" content="summary"/>
    <meta property="og:title" content="R Programming"/>
    <meta property="og:description" content="Slides: R Programming"/>
    <meta property="og:url" content="https://edgar-treischl.github.io/slidesProgramming"/>
    <meta property="og:image" content="https://edgar-treischl.github.io/slidesProgramming&#10;/images/preview.png"/>
    <meta property="og:image:alt" content="Title Slide"/>
    <meta property="og:type" content="website"/>
    <meta property="og:locale" content="en_US"/>
    <meta property="article:author" content="Edgar J. Treischl"/>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="styles.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: left, middle, title-slide





<style>.xe__progress-bar__container {
  top:0;
  opacity: 1;
  position:absolute;
  right:0;
  left: 0;
}
.xe__progress-bar {
  height: 0.25em;
  background-color: #023047;
  width: calc(var(--slide-current) / var(--slide-total) * 100%);
}
.remark-visible .xe__progress-bar {
  animation: xe__progress-bar__wipe 200ms forwards;
  animation-timing-function: cubic-bezier(.86,0,.07,1);
}
@keyframes xe__progress-bar__wipe {
  0% { width: calc(var(--slide-previous) / var(--slide-total) * 100%); }
  100% { width: calc(var(--slide-current) / var(--slide-total) * 100%); }
}</style>









&lt;a href="https://github.com/edgar-treischl/slidesProgramming" class="github-corner" aria-label="View source on GitHub"&gt;&lt;svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"&gt;&lt;path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/&gt;&lt;path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/&gt;&lt;path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/&gt;&lt;/svg&gt;&lt;/a&gt;&lt;style&gt;.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}&lt;/style&gt;

# R Programming

### &lt;a href="http://www.edgar-treischl.de" target="_blank"&gt;Dr. Edgar J. Treischl&lt;/a&gt;

.white[Last update: 2025-11-16]

.footnote.slide-footer[
  Press ‚≠ï or ‚û°Ô∏è to navigate
]

&lt;div class="remark-footer"&gt;&lt;a href="https://unsplash.com/de/@synkevych" target="_blank" style="color: gray;"&gt;Image: Friedrich Justin Bertuch&lt;/a&gt;&lt;/div&gt;






&lt;style type="text/css"&gt;
.reduced_opacity {
  opacity: 0.5;
}
&lt;/style&gt;


---
## Agenda




.pull-left[


### 01 Base R 
### 02 Purrr 
### 03 Purrr and friends 





]

.pull-right[


&lt;img src="images/dragon_meme.jpg" alt="dragon_meme.jpg" width="85%" align="center"/&gt;



]

---
background-image: url("images/touch.gif")
background-size: cover
class: bottom, center


# .white[Base R is a Real Beauty üòÑ] 


---
## R Basics

**Functions for data exploration ** 

.pull-left[


``` r
# View first rows / head of mtcars
head(mtcars)
```

```
##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
```




]

.pull-right[


``` r
# Structure of mtcars
str(mtcars)
```

```
## 'data.frame':	32 obs. of  11 variables:
##  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
##  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
##  $ disp: num  160 160 108 258 360 ...
##  $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
##  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
##  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
##  $ qsec: num  16.5 17 18.6 19.4 17 ...
##  $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
##  $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
##  $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
##  $ carb: num  4 4 1 1 2 1 4 2 2 4 ...
```



]


---
## R Basics II

**Functions for data manipulation ** 


.pull-left[



``` r
# Class of mtcars
class(mtcars)
```

```
## [1] "data.frame"
```


``` r
# Create a vector/Subset the 2nd element
myvec &lt;- c("This", "is", "awesome")
myvec[3]
```

```
## [1] "awesome"
```



]

.pull-right[


``` r
# Subset by condition
head(mtcars[mtcars$cyl == 6, ])
```

```
##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Hornet 4 Drive 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Valiant        18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Merc 280       19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C      17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
```



]


---
## R Basics III


.pull-left[

#### ‚¨ÖÔ∏è Assignment Operator


``` r
# AB(C) of the assignment operator
a &lt;- 5
b &lt;- 6

# The result
result &lt;- a + b
result
```

```
## [1] 11
```


#### ü™Ñ Assign like a Pro, press:


``` r
#&gt; &lt; Alt/Option &gt; + &lt; - &gt;
#&gt; (Windows/Unix)
```



]


.pull-right[

#### üß∞ Functions



``` r
# Create a function
randomize &lt;- function(x) {
  sample_x &lt;- sample(x, 1)
  return(sample_x)
}

# Call and feed the function
randomize(x = c(3, 2, 1, 5, 8, 12, 1))
```

```
## [1] 1
```

#### ü™Ñ Snippet your way, in RStudio, type: 


``` r
#&gt; `fun` and press `&lt;Tab&gt;`
```


]















---
## R Basics Summary

.pull-left[


- **Data Exploration**
  - `head/tail(x)` ‚Äì view first/last rows  
  - `str(x)` ‚Äì structure of an object  
  - `names(x)` ‚Äì column or element names
  - `class(x)` ‚Äì object class

- **Indexing and Subsetting**
  - `x[i]` ‚Äì subset vector  
  - `x[i, j]` ‚Äì subset matrix/data.frame  
  - `x[condition]` ‚Äì logical indexing  
  - `subset(x, condition)` ‚Äì filter rows

- **Vector &amp; Sequence Operations**
  - `c()` ‚Äì combine values into a vector  
  - `seq()`, `rep()` ‚Äì generate sequences/repeats  
  - `sort(x)` ‚Äì sort a vector  
  - `rev(x)` ‚Äì reverse elements
  - `length(x)` ‚Äì length of a vector




]

.pull-right[

- **Basic Math &amp; Statistics**
  - `sum(x)`, `prod(x)` ‚Äì sum/product  
  - `mean(x)`, `median(x)`, `var(x)`, `sd(x)` ‚Äì statistics
  ...

- **Logical &amp; Comparison**
  - `==`, `!=`, `&lt;`, `&gt;`, `&lt;=`, `&gt;=` ‚Äì comparisons  
  - `&amp;`, `|`, `!` ‚Äì logical AND, OR, NOT  
  - `any()`, `all()` ‚Äì check logical conditions over vectors

- **Object Manipulation**
  - `cbind()`, `rbind()` ‚Äì combine matrices or data frames  
  - `merge()` ‚Äì join data frames  
  - `dimnames()` ‚Äì get/set row/column names  
  - `replicate()` ‚Äì repeat expressions


]











---
## Base R: Functions


.pull-left[


#### 1Ô∏è‚É£ Functions as first-class objects
  - you can assign functions to variables, pass them as arguments, and return them from other functions


``` r
# Assigning a function
f &lt;- sum       
f(1:5)
```

```
## [1] 15
```

``` r
# Passing a function as an argument
apply_fun &lt;- function(x, fun) {
  fun(x)
}

apply_fun(1:5, mean)
```

```
## [1] 3
```





]

.pull-right[

#### üëª Anonymous functions
  - functions without names, useful for inline transformations
  - anonymous functions are created on the fly using the `function` keyword and can be passed directly as arguments to other functions
  
  

``` r
# Anonymous functions
sapply(1:5, function(x) x^2)
```

```
## [1]  1  4  9 16 25
```


]


---
## Base R: Functions II

.pull-left[

#### üßΩ Pure functions 

‚Äì functions without side effects (e.g. data export, printing), producing predictable results. 

- Impure functions break predictability, reproducibility, testability, and parallel safety.


``` r
# Impure function
x &lt;- 5

add_to_x &lt;- function(y) {
  x &lt;&lt;- x + y  # modifies a global variable
  return(x)
}

add_to_x(3)
```

```
## [1] 8
```

``` r
add_to_x(2)
```

```
## [1] 10
```

]

.pull-right[


#### üåÄ Closures / lexical scoping
- A closure is a function that captures (or ‚Äúcloses over‚Äù) variables from its surrounding environment ‚Äî meaning it remembers the values that existed when it was created.  



``` r
# A closure
make_power &lt;- function(n) {
  function(x) x^n
}

square &lt;- make_power(2)  
square(4)
```

```
## [1] 16
```


]



---
## Base R: Interation

.pull-left[

#### ‚öôÔ∏è Apply family
- `lapply()`, `sapply()`, `vapply()`, enable iteration without loops. For example, sapply() applies a function to each element and simplifies the output to a vector or matrix when possible.


``` r
# Apply family: Sapply
sapply(iris[1:4], mean)
```

```
## Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
##     5.843333     3.057333     3.758000     1.199333
```

``` r
# Apply family: Mapply
mapply(sum, 1:3, 4:6)
```

```
## [1] 5 7 9
```


]

.pull-right[

#### üëâ Sapply makes it hard to predict the output



``` r
mylist &lt;- list(1:3, 4:6)
class(mylist)
```

```
## [1] "list"
```

``` r
#&gt; 01
mylist &lt;- sapply(mylist, sum)
class(mylist)
```

```
## [1] "integer"
```

``` r
#&gt; 02
mylist &lt;- sapply(mylist, range)
class(mylist)
```

```
## [1] "matrix" "array"
```


]





---
## Base R: Loops

.pull-left[

#### üîÅ While-loop

- repeat operations *as long as a condition is TRUE*.


``` r
# While-loop
count &lt;- 1
result &lt;- c()

while(count &lt;= 5) {
  result &lt;- c(result, count^2)
  count &lt;- count + 1
}

result
```

```
## [1]  1  4  9 16 25
```


Useful when the number of iterations is not known in advance, or when looping depends on a changing condition.




]

.pull-right[

#### üîÇ For-loop
  ‚Äì repeat operations over a sequence of values.



``` r
# For-loop
squares &lt;- numeric(5)

for(i in 1:5) {
  squares[i] &lt;- i^2
}
squares
```

```
## [1]  1  4  9 16 25
```


Useful for iterative tasks, but vectorized alternatives (like `sapply`) are often more concise and faster.



]


---
## Base R (4/4)

.pull-left[


#### üî¢ Vectorization

- performing operations on entire vectors at once, avoiding explicit loops. 
- Leads to **faster, simpler, and more readable code**.



``` r
x &lt;- 1:5

# Loop version (slower)
squares_loop &lt;- numeric(length(x))
for(i in seq_along(x)) {
  squares_loop[i] &lt;- x[i]^2
}

# Vectorized version (faster)
squares_vec &lt;- x^2
squares_vec
```

```
## [1]  1  4  9 16 25
```


]

.pull-right[

#### ‚õìÔ∏è Pipe operator (`%&gt;%`)

- passes the output of one expression as the input to the next, enabling **clear, readable, and sequential transformations**.




``` r
#&gt; Make the native pipe (|&gt;) the default
#&gt; Cmd + Shift + M 

mtcars |&gt; 
  filter(cyl == 6) |&gt; 
  mutate(power_to_weight = hp / wt) |&gt; 
  summarise(avg_ptw = mean(power_to_weight))
```

```
##    avg_ptw
## 1 39.92794
```

Pipelines are great for creating linear, readable code, but when a single chain becomes too long or complex, it‚Äôs better to break it into smaller, named steps for clarity.

]


---
background-image: url("images/nice_dragon.gif")
background-size: cover
class: bottom, center


# .white[Just like purrr ... &lt;br&gt; üê±] 


---
## Hello Purrr

.pull-left[

&lt;div class="info-box"&gt;
  &lt;i&gt;ü¶ú&lt;/i&gt; The purrr package helps you avoid repetitive code (Wickham and Henry 2025). The package is part of the tidyverse and provides a consistent, readable way to perform iteration in R. Instead of writing loops or repeating function calls manually, purrr lets you apply functions over lists, vectors, or data frames using a family of tools like map, map2, and pmap.
&lt;/div&gt;


]

.pull-right[
&lt;figure&gt;
    &lt;a href="https://purrr.tidyverse.org" target="_blank"&gt;&lt;img src="https://purrr.tidyverse.org/logo.png" alt="purrr.tidyverse.org" width="55%" align="center"/&gt;
    &lt;/a&gt;
&lt;/figure&gt;
]


---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%

## map

.pull-left[

The heart of `purrr` is its **mapping functions**, which let you apply a function systematically across a list, vector, or multiple inputs.

&lt;div style="text-align: center;"&gt;
  &lt;a href="https://adv-r.hadley.nz/index.html" target="_blank"&gt;
    &lt;img src="https://adv-r.hadley.nz/diagrams/functionals/map.png" 
         alt="map function: Artwork by Hadley Wickham" 
         width="60%"&gt;
  &lt;/a&gt;
  &lt;p style="font-size: 0.8em; text-align: center;"&gt;
    &lt;em&gt;Artwork: Hadley Wickham&lt;/em&gt;
  &lt;/p&gt;
&lt;/div&gt;





The `map()` function applies a function to each element of a list or vector and **always returns a list**.

]

.pull-right[

``` r
# Create a list of numeric vectors
num_list &lt;- list(a = 1:5, 
                 b = 6:10, 
                 c = 11:15)

# Calculate the mean of each vector
map(num_list, mean)
```

```
## $a
## [1] 3
## 
## $b
## [1] 8
## 
## $c
## [1] 13
```
]


---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%

## map

.pull-left[

Each result is a list element, keeping the structure consistent. If you want a specific type of output, `purrr` provides **type-specific variants** that guarantee the output type, making your code more predictable and reducing subtle bugs.

- `map_dbl()` ‚Äì returns a numeric vector
- `map_chr()` ‚Äì returns a character vector
- `map_int()` ‚Äì returns an integer vector
- `map_lgl()` ‚Äì returns a logical vector
- `map_df()` ‚Äì returns a data frame


]

.pull-right[


``` r
# Using type-specific variants
map_df(mtcars, mean)
```

```
## # A tibble: 1 √ó 11
##     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  20.1  6.19  231.  147.  3.60  3.22  17.8 0.438 0.406  3.69  2.81
```

``` r
map_chr(mtcars, class)
```

```
##       mpg       cyl      disp        hp      drat        wt      qsec        vs        am      gear 
## "numeric" "numeric" "numeric" "numeric" "numeric" "numeric" "numeric" "numeric" "numeric" "numeric" 
##      carb 
## "numeric"
```
]


---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%
## map2 ‚Äì iterating over two inputs

.pull-left[

`map2()` is used when you want to **apply a function to two vectors or lists at the same time**, element by element. 

&lt;div style="text-align: center;"&gt;
  &lt;a href="https://adv-r.hadley.nz/index.html" target="_blank"&gt;
    &lt;img src="https://adv-r.hadley.nz/diagrams/functionals/map2.png" 
         alt="map function: Artwork by Hadley Wickham" 
         width="60%"&gt;
  &lt;/a&gt;
  &lt;p style="font-size: 0.8em; text-align: center;"&gt;
    &lt;em&gt;Artwork: Hadley Wickham&lt;/em&gt;
  &lt;/p&gt;
&lt;/div&gt;

So, `map2()` takes three main arguments:  
  1. The first input vector or list (`.x`)  
  2. The second input vector or list (`.y`)  
  3. The function to apply to each pair of elements 


]

.pull-right[



``` r
column_names &lt;- names(mtcars)
column_means &lt;- map_dbl(mtcars, mean)

map2result &lt;- map2_chr(
  column_names,
  column_means, ~ paste(
    .x, "mean =",
    round(.y, 1)
  )
)
map2result[1:3]
```

```
## [1] "mpg mean = 20.1"   "cyl mean = 6.2"    "disp mean = 230.7"
```

Here, `.x` refers to an element from the first vector (`column_names`), `.y` refers to the corresponding element from the second vector (`column_means`); the tilde (`~`) creates an anonymous function.

]


---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%
## pmap ‚Äì iterating over multiple inputs

.pull-left[

When you have **more than two inputs**, `pmap()` generalizes this idea. It takes a **list of vectors or lists** and applies a function to corresponding elements across all inputs.

&lt;div style="text-align: center;"&gt;
  &lt;a href="https://adv-r.hadley.nz/index.html" target="_blank"&gt;
    &lt;img src="https://adv-r.hadley.nz/diagrams/functionals/pmap.png" 
         alt="map function: Artwork by Hadley Wickham" 
         width="60%"&gt;
  &lt;/a&gt;
  &lt;p style="font-size: 0.8em; text-align: center;"&gt;
    &lt;em&gt;Artwork: Hadley Wickham&lt;/em&gt;
  &lt;/p&gt;
&lt;/div&gt;





]

.pull-right[

Imagine we want to combine column names, means, and standard deviations:


``` r
column_sds &lt;- map_dbl(mtcars, sd)
inputs &lt;- list(column_names, column_means, column_sds)

pmap_result &lt;- pmap(
  inputs,
  ~ paste(
    ..1, " with a mean =", round(..2, 1),
    " and a sd =", round(..3, 1)
  )
)
```

Here, `..1`, `..2`, `..3` refer to elements from the first, second, and third lists, respectively. 


]


---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%
## pmap II


``` r
# Show the first 3 results of the list
pmap_result[1:3]
```

```
## [[1]]
## [1] "mpg  with a mean = 20.1  and a sd = 6"
## 
## [[2]]
## [1] "cyl  with a mean = 6.2  and a sd = 1.8"
## 
## [[3]]
## [1] "disp  with a mean = 230.7  and a sd = 123.9"
```


#### üëâ `pmap()` allows you to work cleanly with **any number of parallel inputs**, keeping your code short and readable while avoiding nested loops.



---
background-image: url("images/leuchtturm.gif")
background-size: cover
class: bottom, center


# .white[FP in Action ‚úä] 

---
## Example: Reading and Cleaning Data


Imagine, a folder full of CSV files, all with the same structure, and we need to import them and clean the column names.

.pull-left[


#### The manual ‚úã approach



``` r
df1 &lt;- read.csv("df1.csv")
df1 &lt;- janitor::clean_names(df1)
...
df101 &lt;- read.csv("df101.csv")
```


Don't: This is tedious and error-prone!




]

.pull-right[


#### The ‚ûø loooop



``` r
files &lt;- list.files("data", pattern = "*.csv", full.names = TRUE)
dfs &lt;- list()

for (i in seq_along(files)) {
  df &lt;- read.csv(files[i])
  df &lt;- janitor::clean_names(df)
  dfs[[i]] &lt;- df
}
```



]

The loop works, better than a manual approch, but there are some downsides:
- You have to manually manage the **index** `i` and the `dfs` list.
- The code is **verbose**, with variables that can clutter your workspace.
- It‚Äôs **less composable**, making it harder to fit into a pipe-based workflow or reuse as a function.

---
## Gapminder


- The Gapminder data contains country-level statistics on life expectancy, GDP per capita, and population over time.

&lt;figure&gt;
    &lt;a href="https://www.gapminder.org" target="_blank"&gt;&lt;img src="images/gapminder.png" alt="gapminder bubble chart" width="70%" align="center"/&gt;
    &lt;/a&gt;
&lt;/figure&gt;


- I splitted the original dataset into separate files by country and year. 

- Your task is to read all CSV files and combine them into a single cleaned data frame.





---
## Example: Reading and Cleaning Data

Function programming with purrr is often cleaner, safer, and easier to maintain: 

.pull-left[

- **No manual indexing** ‚Äî `map()` takes care of iterating over each file automatically. No need to track `i` or worry about list positions.  
- **Clean and readable** ‚Äî the workflow reads top-down: read the file, clean the names, done. No clutter from intermediate variables.  
- **Predictable and type-safe** ‚Äî `map()` always returns a list, so `dfs` is consistent and reliable.  
- **Easily reusable** ‚Äî wrap this logic in a function, and you can apply it to any folder of files without rewriting the loop.





]

.pull-right[

#### Hallo üê±





``` r
library(purrr)
library(janitor)

files &lt;- list.files("data", pattern = "*.csv", full.names = TRUE)

dfs &lt;- files |&gt;
  map(read.csv) |&gt;
  map(clean_names)
```



]


---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%

## imap

.pull-left[

`imap()` is a variant of `map()` that supplies **both the element and its name (or index)** to the function.  
This makes it useful when you need to work with **values + names** at the same time.


`imap()` applies a function to each element of a list or vector and passes two arguments:
- `.x` = the value  
- `.y` = the name (or index)

It **always returns a list**, like `map()`.

]

.pull-right[

``` r
# A named list
num_list &lt;- list(a = 1:3,
                 b = 4:6,
                 c = 7:9)

# Use imap() to create labeled summaries
imap(num_list, ~ paste0("Mean of ", .y, ": ", mean(.x)))
```

```
## $a
## [1] "Mean of a: 2"
## 
## $b
## [1] "Mean of b: 5"
## 
## $c
## [1] "Mean of c: 8"
```
]



---
## Example: Creating Multiple Plots


.pull-left[

- `imap()` iterates over both the **values** and **names** of each column in `mtcars`.  
- For every column (`.x`), it checks if it‚Äôs numeric using `is.numeric(.x)`.  
- If it is, a `ggplot` histogram is created.
- The column name (`.y`) is used dynamically in the plot title.  
- All resulting plots are stored neatly in a **list object** called `plots`, ready for display or export.


]

.pull-right[



``` r
library(ggplot2)
library(purrr)

# Create a histogram for each numeric column
plots &lt;- imap(mtcars, ~ {
  if(is.numeric(.x)) {
    ggplot(mtcars, aes(x = .x)) +
      geom_histogram(bins = 10, fill = "steelblue") +
      ggtitle(paste("Histogram of", .y))
  }
})

# A list of plots
class(plots)
```

```
## [1] "list"
```



]

When iterating over many elements, not every operation will go smoothly ‚Äî some columns might be non-numeric, a plot might fail to render, or a transformation could throw an error.

---
background-image: url("images/cartoon.gif")
background-size: cover
class: bottom, center


# .white[Purrr and friends to slay the üêâ] 


---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%
## safely

.pull-left[

`safely()` **catches errors** and returns them as part of the output, rather than halting execution. It transforms a function that always returns a **list** with two elements:

- `result`: the output (or `NULL` if an error occurred)  
- `error`: the error message (or `NULL` if everything worked)



``` r
# Some test inputs
data_list &lt;- list(
  c("a", "b", "c"),
  c(1, 2, 3)
)

mean(data_list[[1]])
```

```
## Warning in mean.default(data_list[[1]]): argument is not numeric or logical: returning NA
```

```
## [1] NA
```



]

.pull-right[



``` r
# Wrap mean() safely
safe_mean &lt;- safely(mean)

# Apply safely-wrapped mean() to each element
results &lt;- map(data_list, safe_mean)

# Extract via map
numeric_results &lt;- map(results, "result")
errors &lt;- map(results, "error")

# Keep only successful numeric results and simplify to a vector
flatten_dbl(compact(numeric_results))
```

```
## [1] NA  2
```




]

---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%
## possibly

.pull-left[

`possibly()` **replaces errors with a default value** rather than halting execution. It transforms a function so that if an error occurs, it returns a **fallback value** you specify (via `.otherwise`).

This is useful when you want to keep going but don‚Äôt need the error details.


``` r
# Function
do &lt;- function(x) {
  if (!is.numeric(x)) stop("Not numeric!")
  mean(x)
}

# Test inputs
data_list &lt;- list(
  "a",          
  c(1, 2, 3)
)
```

]

.pull-right[




``` r
# Wrap with possibly()
safe_test2 &lt;- possibly(do, otherwise = NA_real_)
map_dbl(data_list, safe_test2)
```

```
## [1] NA  2
```

Here, instead of stopping (or returning lists of errors),
possibly() returns the numeric fallback NA for the failed call and proceeds smoothly.

]

---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%
## walk


.pull-left[

- The `walk()` function is perfect for operations that have **side effects**, such as saving files, printing messages, or generating plots. 

- It behaves just like `map()`, but it **returns nothing**, keeping your workflow clean when you only care about the action being performed.

- Plus: The `.progress = TRUE` option automatically shows a progress bar while mapping, which is invaluable for long-running tasks.


]

.pull-right[

For example, after creating your list of plots, you can easily export them all at once:


``` r
library(purrr)
library(ggplot2)

# Save each plot to file
walk(names(plots), ~ {
  ggsave(
    filename = paste0(.x, "_plot.png"),
    plot = plots[[.x]],
    width = 6,
    height = 4
  )
})
```

]


---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%
## quietly

.pull-left[

`quietly()` **captures all output** generated by a function. It returns a **list** with four elements:

- `result`: the function output (or `NULL`)  
- `output`: captured printed output  
- `warnings`: any warnings generated  
- `messages`: any messages generated

This is useful when you want to **run a function silently** but still inspect what happened.


``` r
# Example function
example_fun &lt;- function(x) {
  message("A message")
  warning("A warning")
  print(x)
  x + 1
}
```

]

.pull-right[




``` r
library(purrr)

# Wrap the function quietly
quiet_fun &lt;- quietly(example_fun)

# Apply to a value
result &lt;- quiet_fun(5)

# Inspect the result/output/etc.
result$result
```

```
## [1] 6
```

All output, warnings, and messages are captured in the list elements for inspection.
]

]




---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%
## Parallel Processing


.pull-left[

- When performance is important ‚Äî say you‚Äôre generating hundreds of plots or running computationally‚Äëheavy tasks ‚Äî the parallel capabilities of `purrr` come into play. 

- Starting with version 1.2.0, `purrr` supports parallel execution via the `in_parallel()` ‚Äúadverb‚Äù.

- Parallelism can significantly speed up operations by distributing tasks across multiple CPU cores. The latter is also a advanced topic which is why we only touch it briefly here.



]

.pull-right[


``` r
# Prepare inputs
column_names &lt;- names(mtcars)
column_data  &lt;- mtcars
# Ensure daemons are running
mirai::daemons(4)
mirai::require_daemons()
```




]


---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%
## Parallel Processing II


Now we can export the list of plots in parallel:


``` r
# Export histograms in parallel
plots_parallel &lt;- map2(
  column_names, column_data,
  ~ in_parallel(
      \(col_name, data) {
        ggplot2::ggplot(data, ggplot2::aes(x = .data[[col_name]])) +
          ggplot2::geom_histogram(bins = 10, fill = "steelblue") +
          ggplot2::ggtitle(paste("Histogram of", col_name))
      },
      col_name  = .x,
      data      = .y
    )
)
```







---
class: right, middle


## Thank you for your attention!


&lt;img style="border-radius: 50%;" src="https://avatars.githubusercontent.com/u/77931249?s=400&amp;u=eaf1d0871b643dd32cc0ff9f777edef28e6569a8&amp;v=4" width="150px"/&gt;



[&lt;svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M505.12019,19.09375c-1.18945-5.53125-6.65819-11-12.207-12.1875C460.716,0,435.507,0,410.40747,0,307.17523,0,245.26909,55.20312,199.05238,128H94.83772c-16.34763.01562-35.55658,11.875-42.88664,26.48438L2.51562,253.29688A28.4,28.4,0,0,0,0,264a24.00867,24.00867,0,0,0,24.00582,24H127.81618l-22.47457,22.46875c-11.36521,11.36133-12.99607,32.25781,0,45.25L156.24582,406.625c11.15623,11.1875,32.15619,13.15625,45.27726,0l22.47457-22.46875V488a24.00867,24.00867,0,0,0,24.00581,24,28.55934,28.55934,0,0,0,10.707-2.51562l98.72834-49.39063c14.62888-7.29687,26.50776-26.5,26.50776-42.85937V312.79688c72.59753-46.3125,128.03493-108.40626,128.03493-211.09376C512.07526,76.5,512.07526,51.29688,505.12019,19.09375ZM384.04033,168A40,40,0,1,1,424.05,128,40.02322,40.02322,0,0,1,384.04033,168Z"&gt;&lt;/path&gt;&lt;/svg&gt; www.edgar-treischl.de](https://www.edgar-treischl.de)

[&lt;svg viewBox="0 0 496 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"&gt;&lt;/path&gt;&lt;/svg&gt; edgar-treischl](https://github.com/edgar-treischl)

[&lt;svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"&gt;&lt;/path&gt;&lt;/svg&gt; edgar.treischl@isb.bayern.de](mailto:edgar.treischl@isb.bayern.de)


---
class: right, middle



## Licence

This presentation is licensed under a CC-BY-NC 4.0 license.
You may copy, distribute, and use the slides in your own work, as long as you give attribution to the original author on each slide that you use. Commercial use of the contents of these slides is not allowed.
&lt;br/&gt;
&lt;br/&gt;
&lt;img src="images/by-nceu.png" alt="Licence" width="150px"/&gt;




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
  "ratio": "16:9",
  "highlightStyle": "github",
  "highlightLines": true,
  "countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
